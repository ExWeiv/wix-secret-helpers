"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSecretValue=u;const r=e(require("@cacheable/node-cache")),t=require("@wix/essentials"),s=require("@wix/secrets"),n=require("neverthrow"),o="Secret Helpers Error:",i=new r.default({stdTTL:360,deleteOnExpire:!0,checkperiod:120}),a=new r.default({stdTTL:360,deleteOnExpire:!0,checkperiod:120});async function u(e,r=!1,t=!0){if(!e)throw new Error(`${o} secretName must be a valid string value!`);if(!1===t){const t=await l(e,r);if(t.isOk())return t.value;throw new Error(t.error.message)}const s=i.get(e);if(s){const t=r?c(s,e):(0,n.ok)(s);if(t.isOk())return t.value;throw new Error(t.error.message)}{const t=await l(e,r);if(t.isOk())return t.value;throw new Error(t.error.message)}}function c(e,r){try{if(a.has(r)){const e=a.get(r);return(0,n.ok)(e)}const t=JSON.parse(e);return a.set(r,t),(0,n.ok)(t)}catch(e){const r=e instanceof Error?e:new Error(String(e));return(0,n.err)(r)}}async function l(e,r=!1){const a=t.auth.elevate(s.secrets.getSecretValue),u=await(0,n.fromPromise)(a(e),e=>e instanceof Error?e:new Error(String(e)));if(u.isOk()){const{value:t}=u.value;return t?(i.set(e,t),r?c(t,e):(0,n.ok)(t)):(0,n.err)(new Error(`${o} secret value is undefined! Response from Wix: ${t}`))}return(0,n.err)(new Error(`${o} unable to get the secret value from Wix!\n ${u.error.message}`))}exports.default={getSecretValue:u};
//# sourceMappingURL=lib/index.js.map